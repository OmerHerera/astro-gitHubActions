name: CI
concurrency: ${{ github.workflow }}-${{ github.ref }}

on: push

jobs:
  job_1:
    name: ci
    timeout-minutes: 10
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - name: Checkout Code
        if: false
        uses: actions/checkout@v3
        with:
          path: my-repo
      
      - name: Cache dependencies
        if: false
        uses: actions/cache@v2
        with:
          path: |
            ~/.npm
          key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-npm-
      
      - name: Install dependencies
        if: false
        run: cd my-repo && npm install
      
      - name: Get current time in milliseconds
        if: false
        run: echo "time_milliseconds=$(date +%s%3N)" >> $GITHUB_ENV
        id: current_time

      - name: Create file
        if: false
        run: | 
          echo '{"buildNum": 5, "timestamp": ${{ env.time_milliseconds }} }' > build.number.json
          echo $(cat build.number.json)
      
      - name: Gzip JS files
        run: |
          find src/layouts -type f -name "*.astro" -exec sh -c "gzip < {} > {}.gz" \\;
          echo "Gzip completed"
      
      - name: Display result
        run: find src/layouts -type f -name "*.js.gz" 
      
      # - name: Use the output time
      #   if: true
      #   run: |
      #     echo "Time Milliseconds-> ${{ env.time_milliseconds }}"
      
      # - name: Install dependencies
      #   run: npm ci --ignore-scripts

  # job_2:
  #   name: ci2
  #   if: false
  #   timeout-minutes: 10
  #   runs-on: ubuntu-latest
  #   needs: job_1
  #   permissions:
  #     id-token: write
  #     contents: read
  #   steps:
  #     - name: Restore dependencies
  #       uses: actions/cache@v2
  #       with:
  #         path: |
  #           ~/.npm
  #         key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
      
  #     - name: Use checked out code
  #       run: cd my-repo && ll && npm run dev
  # call-workflow:
  #   uses: ./.github/workflows/ci2.yml


# name: Share data between jobs

# on: [push]

# jobs:
#   job_1:
#     name: Add 3 and 7
#     runs-on: ubuntu-latest
#     steps:
#       - shell: bash
#         run: |
#           expr 3 + 7 > math-homework.txt
#       - name: Upload math result for job 1
#         uses: actions/upload-artifact@v3
#         with:
#           name: homework
#           path: math-homework.txt

#   job_2:
#     name: Multiply by 9
#     needs: job_1
#     runs-on: windows-latest
#     steps:
#       - name: Download math result for job 1
#         uses: actions/download-artifact@v3
#         with:
#           name: homework
#       - shell: bash
#         run: |
#           value=`cat math-homework.txt`
#           expr $value \* 9 > math-homework.txt
#       - name: Upload math result for job 2
#         uses: actions/upload-artifact@v3
#         with:
#           name: homework
#           path: math-homework.txt

#   job_3:
#     name: Display results
#     needs: job_2
#     runs-on: macOS-latest
#     steps:
#       - name: Download math result for job 2
#         uses: actions/download-artifact@v3
#         with:
#           name: homework
#       - name: Print the final result
#         shell: bash
#         run: |
#           value=`cat math-homework.txt`
#           echo The result is $value